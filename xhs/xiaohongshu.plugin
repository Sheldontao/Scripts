#!name=xiaohongshu
#!desc=Regexå‚ç…§é»˜è®¤æ ¼å¼ï¼ï¼ŒæŸäº›APPè¦æ¸…é™¤ç¼“å­˜æˆ–è€…é‡æ–°å®‰è£…æ‹¦æˆªå¹¿å‘Šæ‰ä¼šç”Ÿæ•ˆï¼
#!author=å¥¶æ€[https://github.com/fmz200], Leo
#!icon=https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/gif/naisi-01.gif
#!homepage=https://github.com/fmz200/wool_scripts
#!raw-url=https://github.com/fmz200/wool_scripts/raw/main/Loon/plugin/blockAds.plugin
#!tg-group=https://t.me/lanjieguanggao
#!category=å¥¶æ€çš„æ¨¡å—
#!system=iOS, iPadOS
#!system_version = 18ios
#!loon_version = 
#!date=2025-8-21(2025-09-16); app_version = v8.93
#!remark=ä¸‹æ–¹çš„æ‰€æœ‰è§„åˆ™éƒ½æ ‡æ³¨äº†å¯¹åº”çš„hostnameï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯æˆ–è€…é—æ¼ï¼Œæ¬¢è¿åé¦ˆã€‚å¯¹äºæ— æ³•/å¯é€‰MITMçš„hostnameéƒ½ç‰¹åˆ«åšäº†â€œå¦‚å¼€å¯å¯è‡ªè¡Œæ·»åŠ ä¸»æœºåâ€æç¤ºï¼Œå¦‚æœæç¤ºåé¢æ²¡æœ‰æ ‡æ³¨ä¸»æœºååˆ™åŒ…å«æ‰€æœ‰ä¸»æœºåï¼Œå¦åˆ™åªåŒ…å«æç¤ºè¯­åé¢çš„ä¸»æœºåã€‚
#############################################
# "reject"        ç­–ç•¥è¿”å› HTTP çŠ¶æ€ç  404,ä¸é™„å¸¦ä»»ä½•é¢å¤–å†…å®¹
# "reject-200"    ç­–ç•¥è¿”å› HTTP çŠ¶æ€ç  200,ä¸é™„å¸¦ä»»ä½•é¢å¤–å†…å®¹
# "reject-img"    ç­–ç•¥è¿”å› HTTP çŠ¶æ€ç  200,åŒæ—¶é™„å¸¦ 1px gif
# "reject-dict"   ç­–ç•¥è¿”å› HTTP çŠ¶æ€ç  200,åŒæ—¶é™„å¸¦ä¸€ä¸ªç©ºçš„ JSON å¯¹è±¡
# "reject-array"  ç­–ç•¥è¿”å› HTTP çŠ¶æ€ç  200,åŒæ—¶é™„å¸¦ä¸€ä¸ªç©ºçš„ JSON æ•°ç»„
#############################################
# å¸¸è§é—®é¢˜ï¼š
# 1ï¸âƒ£ï¼šæˆ‘çŸ¥é“è§„åˆ™ï¼Œä¸çŸ¥é“ä¸»æœºåæ€ä¹ˆåŠï¼Ÿ
# âœ…ï¼šå‡ ä¹æ‰€æœ‰çš„ä¸»æœºåéƒ½æ˜¯ä»è§„åˆ™ä¸­æå–å‡ºæ¥çš„ï¼Œå…ˆæœ‰çš„è§„åˆ™å†æœ‰çš„ä¸»æœºå
# ä¸¾ä¸ªæ —å­ï¼š12306çš„ä¸€æ¡è§„åˆ™URLğŸ‘‰ğŸ»^https?:\/\/ad\.12306\.cn\/ad\/ser\/getAdList
# åªéœ€è¦å»æ‰åæ–œæ ï¼š^https?://ad.12306.cn/ad/ser/getAdList
# ä¸ç”¨å†è¯´äº†å§ï¼Œad.12306.cnå°±æ˜¯æƒ³è¦çš„ä¸»æœºå
# 2ï¸âƒ£ï¼šæœ‰äº›å¸¸ç”¨çš„è½¯ä»¶ä¸ºä»€ä¹ˆæ²¡æœ‰å»å¹¿å‘Šé…ç½®ï¼Ÿ
# âœ…ï¼šå¦‚æœè¦åˆ©ç”¨é‡å†™å»å¹¿å‘Šï¼Œå°±éœ€è¦å¯¹è¯·æ±‚æˆ–å“åº”ä¿¡æ¯è¿›è¡Œè§£å¯†(MITM)ï¼Œç°åœ¨ä¸€äº›è½¯ä»¶å·²ç»ç¦æ­¢äº†MITMï¼Œæ‰€ä»¥å°±æ— æ³•å»å¹¿å‘Šã€‚
# 3ï¸âƒ£ï¼šLoonå¦‚æœåœ¨æ’ä»¶é‡Œé¢å†™äº†è§„åˆ™ï¼Œåœ¨è§„åˆ™é…ç½®é‡Œä¹Ÿå†™äº†ï¼Œå“ªä¸ªä¼˜å…ˆç”Ÿæ•ˆï¼Ÿ
# âœ…ï¼šæ’ä»¶é‡Œçš„è§„åˆ™ä¼˜å…ˆç”Ÿæ•ˆã€‚
#############################################

[Argument]
xhs_enable = switch,true,false,tag=å°çº¢ä¹¦-è„šæœ¬å¼€å…³
xhs_des_regex = input,"["å³°å“¥", "æ‹çˆ±", "é›ªèŒ„", "æ–°é—»", "manus", "æ½ä½¬", "çº¢åå­—", "èƒ¡é”¡è¿›"]",tag=xhs_des_regex
xhs_nickname_regex = input,"["æ–°é—»","çº¢åå­—","æ—¥æŠ¥","æ™šæŠ¥","ç”µå½±","å‰ªè¾‘","å½±è§†","å³°å“¥","ä¸»æ’­","å¹¿æ’­","è§†é¢‘","è°ˆ.*è§„åˆ’",".+[å§å“¥].*è°ˆ","è€å…µ","ai","AI","æ–°å","åŒºå—é“¾"]",tag=xhs_nickname_regex
xhs_counts_threshold = input, "[0,10,10,0,0]", tag=xhs_counts_threshold_ç‚¹èµæœ€ä½/æ”¶è—/è¯„è®º/åˆ†äº«/å¥½
xhs_search_des_regex = input, "["ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼",""]",tag=xhs_search_des_regex
xhs_search_nickname_regex = input, "["ä¸­ä»‹","çœ‹æˆ¿","æ¢è®¿","å¥½æˆ¿","ç§Ÿæˆ¿"]", tag=xhs_search_nickname_regex

[Rule]
DOMAIN, ads-img-qc.xhscdn.com, REJECT
DOMAIN, ads-video-al.xhscdn.com, REJECT
DOMAIN, ads-video-qc.xhscdn.com, REJECT
DOMAIN, t-ads.xiaohongshu.com, REJECT
AND, ((PROTOCOL, QUIC), (DOMAIN-SUFFIX, xiaohongshu.com)), REJECT


[Rewrite]

# æƒŠå–œå¼¹çª—
^https:\/\/edith\.xiaohongshu\.com\/api\/sns\/v1\/surprisebox\/(?:get_style|open|submit_action) reject-dict
^https?:\/\/www\.xiaohongshu\.com\/api\/marketing\/box\/trigger\? reject-dict
# ä¿¡æ¯æµ
^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/note\/guide\? reject-dict
^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/note\/detailfeed\/preload\? reject-dict
^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/guide\/user_banner reject-dict
^https?:\/\/www\.xiaohongshu\.com\/api\/sns\/(v\d+\/ads\/resource|v\d+\/hey\/\w+\/hey_gallery) reject-dict
# è¯„è®ºåŒºå›¾ç‰‡æ°´å°
^https?:\/\/ci\.xiaohongshu\.com\/system_config\/watermark reject-img



[Script]


# > å°çº¢ä¹¦
# æœç´¢é¡µ
http-response ^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/search\/(banner|hot)_list script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦æœç´¢é¡µ, enable={xhs_enable}
http-response ^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/search\/(hint|trending)\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦æœç´¢é¡µ, enable={xhs_enable}
http-response ^https?:\/\/(so|edith)\.xiaohongshu\.com\/api\/sns\/v\d+\/search\/notes\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦æœç´¢é¡µ, enable={xhs_enable}, argument = [{xhs_search_des_regex},{xhs_search_nickname_regex}]
# å¼€å±å¹¿å‘Š
http-response ^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/system_service\/config\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦å¼€å±å¹¿å‘Š, enable={xhs_enable}
http-response ^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/system_service\/splash_config script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦å¼€å±å¹¿å‘Š, enable={xhs_enable}
# è¯¦æƒ…é¡µ,å°éƒ¨ä»¶
http-response ^https?:\/\/edith\.xiaohongshu\.com\/api\/sns\/v\d+\/note\/widgets script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦è¯¦æƒ…é¡µ, enable={xhs_enable}
# å›¾ç‰‡æ°´å°,è§†é¢‘æ°´å°,homefeed regexè¿‡æ»¤
http-response ^https?:\/\/(edith|rec|www)\.xiaohongshu\.com\/api\/sns\/v\d+\/note\/(imagefeed|live_photo\/save) script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å›¾ç‰‡æ°´å°è§†é¢‘æ°´å°, enable={xhs_enable}
http-response ^https?:\/\/(edith|rec|www)\.xiaohongshu\.com\/api\/sns\/v\d+\/(followfeed|homefeed)\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=regexè¿‡æ»¤+å›¾ç‰‡æ°´å°è§†é¢‘æ°´å°, enable={xhs_enable}, argument = [{xhs_des_regex},{xhs_nickname_regex},{xhs_counts_threshold}]
http-response ^https?:\/\/(edith|rec|www)\.xiaohongshu\.com\/api\/sns\/(v2\/note\/feed|v3\/note\/videofeed)\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å›¾ç‰‡æ°´å°è§†é¢‘æ°´å°, enable={xhs_enable}
http-response ^https?:\/\/(edith|rec|www)\.xiaohongshu\.com\/api\/sns\/(v4\/note\/videofeed|v10\/note\/video\/save)\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å›¾ç‰‡æ°´å°è§†é¢‘æ°´å°, enable={xhs_enable}
# è¯„è®ºåŒºå›¾ç‰‡ã€liveå›¾æ°´å°ï¼Œè¡¨æƒ…åŒ…ä¸‹è½½
http-response ^https:\/\/edith\.xiaohongshu\.com\/api\/sns\/(v5\/note\/comment\/list|v3\/note\/comment\/sub_comments)\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦è¯„è®ºåŒºå»æ°´å°å­˜å‚¨, enable={xhs_enable}
http-response ^https:\/\/edith\.xiaohongshu\.com\/api\/sns\/v1\/interaction\/comment\/video\/download\? script-path=https://raw.githubusercontent.com/Sheldontao/Scripts/refs/heads/main/xhs/xhs_fmz200.js, requires-body=true, timeout=60, tag=å°çº¢ä¹¦è¯„è®ºåŒºå»æ°´å°ä¸‹è½½, enable={xhs_enable}




# =====================================
# MITMï¼šä¸­é—´äººæ”»å‡»ï¼Œè§£å¯†/è·³è¿‡ç›¸å…³åŸŸåçš„å†…å®¹ï¼Œ"-"å¼€å¤´ä¸ºè·³è¿‡
# =====================================
[MITM]
hostname = www.xiaohongshu.com, edith.xiaohongshu.com, ci.xiaohongshu.com, rec.xiaohongshu.com, so.xiaohongshu.com